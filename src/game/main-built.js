define("util",[],function(){var e=["smiley","laughy","holy","geary","sunny","rady"],t=["geary","sunny","rady"],n=["hearty","bolty"];return{keys:{SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13},isAGameKey:function(e){for(key in this.keys)if(e===this.keys[key])return!0;return!1},sprites:{suzhiTitle:[0,60,100,30],gameOver:[0,0,210,25],getReady:[0,33,200,25],tapHelp:[0,100,180,165],howTo:[10,365,265,225],suzhi:[253,0,47,47],suzhiHappy:[299,0,47,47],suzhiHurt:[345,0,47,47],smiley:[211,59,36,36],laughy:[202,106,48,48],holy:[190,160,70,70],geary:{1:[257,60,35,35],2:[306,60,35,35]},sunny:{1:[255,105,47,47],2:[313,105,47,47]},rady:{1:[258,170,53,53],2:[313,170,53,53]},fire:[[377,315,18,35],[360,315,18,35],[334,315,18,35],[308,315,18,35],[278,315,18,35],[248,315,18,35],[219,315,18,35],[194,315,18,35],[166,315,18,35],[141,315,18,35],[117,315,18,35],[97,315,18,35],[75,315,18,35],[52,315,18,35],[25,315,18,35],[0,315,18,35]],okayBtn:[0,270,62,20],playBtn:[0,292,62,20],score:[111,65,83,20],heart:[144,240,20,18],bigHeart:[76,240,68,66],bigBolt:[203,245,38,55],bolt:[255,245,13,18],lblPress:[5,370,91,20],lblToStart:[228,370,137,20],lblAnyKey:[102,370,120,20],lblEnterKey:[5,396,151,20],lblMove:[44,549,52,15],lblControls:[182,467,115,18],lblFire:[222,549,41,15],arrowKeys:[5,450,135,95],spacebar:[145,500,200,42]},spriteTest:function(e,t){var n=this.sprites.spacebar;this.drawSprite(e,t,n,100,100),e.strokeStyle="white",e.strokeRect(100,100,n[2],n[3])},drawSprite:function(e,t,n,r,i,s){s=0,e.drawImage(t,n[0],n[1],n[2],n[3],r,i,n[2]-s,n[3]-s)},env:function(){return{viewport:{width:window.innerWidth,height:window.innerHeight},canTouch:this.canTouch()}},canTouch:function(){var e=document.createElement("div"),t="ontouchstart"in e;return t||(e.setAttribute("ontouchstart","return;"),t=typeof e["ontouchstart"]=="function"),e=null,t},getMouseAt:function(e,t){var n,r;return e.x&&e.y?(n=e.x-t.offsetLeft,r=e.y-t.offsetTop):(n=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-t.offsetLeft,r=e.clientY+document.body.scrollTop+document.documentElement.scrollTop-t.offsetTop),{x:n,y:r}},randomPoint:function(e,t){return t=t||10,{x:Math.random()*(e.width-t-t)+t,y:Math.random()*(e.height-t-t)+t}},randomPointInBox:function(e,t,n,r){return{x:Math.random()*(n-e)+e,y:Math.random()*(r-t)+t}},randomNumber:function(e,t){return Math.floor(Math.random()*(e-t))+t},randomGoody:function(){return e[Math.floor(Math.random()*e.length)]},randomBaddie:function(){return t[Math.floor(Math.random()*t.length)]},randomAddon:function(){return n[Math.floor(Math.random()*n.length)]},getAllGoodies:function(){return e},collided:function(e,t){var n,r,i,s,o,u,a,f;return n=e.x,i=e.x+e.w,o=e.y,a=e.y+e.h,r=t.x,s=t.x+t.w,u=t.y,f=t.y+t.h,!(n>s||r>i||o>f||u>a)},isPointInsideBox:function(e,t){return e.x1<=t.x&&e.x2>=t.x&&e.y1<=t.y&&e.y2>=t.y}}}),define("colors",[],function(){return{bg:"rgb(0,31,63)",text:"rgb(255,255,255)",suzhi:"rgb(255,220,0)",goody:"rgb(1,255,112)",baddie:"rgb(255,65,54)",title:"rgb(255,220,0)",lifelineGood:"rgba(1,255,112,.6)",lifelineBad:"rgba(255,65,54,.6)",hudColor:"rgba(221,221,221,.1)",hudText:"rgba(255,255, 255, .8)",boltColor:"rgba(255, 255, 255, .51)"}}),define("suzhi",["util","colors"],function(e,t){function l(t){this.x=0,this.y=0,this.size=47,this.lifelineSize=this.size/2+2,this.yVelocity=0,this.sprite=t.sprite,this.coords=e.sprites.suzhi,this.moods={normal:e.sprites.suzhi,hurt:e.sprites.suzhiHurt,happy:e.sprites.suzhiHappy},this.init(t.canvas),this.bolts=[]}var n=.25,r=10,i=8,s=50,o=7,u=20,a=e.keys,f=50;return l.prototype={init:function(e){this.x=e.width/2,this.y=e.height/2,this.cH=e.height,this.cW=e.width,this.score=0,this.mood="normal",this.health=100,this.ammo=5,this.flashMood=0},actOn:function(e){e===a.UP?this.jump():e===a.LEFT?this.move("left"):e===a.RIGHT?this.move("right"):e===a.DOWN?this.fall():e===a.SPACE&&this.fire()},move:function(e){var t=this.xy(),n=e==="left"?100:-100;t.x+=n,this.jump(t,2,.1)},fire:function(){if(this.ammo>0){var e=this.mid();this.bolts.push({x:e.x,y:e.y,fired:!0,energy:f,size:this.size-10}),this.ammo-=1}},isBolted:function(t){var n={x:t.x,y:t.y,h:t.height,w:t.width},r,i,s,o=this.bolts.length;for(i=0;i<o;i++){s=this.bolts[i],r={x:s.x-s.size,y:s.y-s.size,h:2*s.size-20,w:2*s.size-20};if(e.collided(r,n))return this.score+=Math.abs(t.value),!0}},fall:function(){this.yVelocity=Math.abs(this.yVelocity),this.xVelocity=0},jump:function(e,t,n){e=e||this.xy(),t=t||1,n=n||1;var i,u,a,f;u=e.y-this.y,i=e.x-this.x,a=t*(r*i/this.cW),f=n*s,this.xVelocity=-a,this.yVelocity=-Math.min(f,o),this.inMotion=!0},stop:function(){this.inMotion=!1,this.isDead=!0,this.mood="hurt",this.health=0},update:function(){var e=this.position(),t,r,i=this.bolts.length;this.inMotion&&(this.yVelocity+=n,this.y+=this.yVelocity,this.x+=this.xVelocity),(this.health<=0||e.bottom>=this.cH-17)&&this.stop(),e.top<=30&&this.yVelocity<0&&(this.yVelocity=Math.abs(this.yVelocity)),e.left<=0&&this.xVelocity<0&&(this.xVelocity=Math.abs(this.xVelocity)),e.right>=this.cW&&this.xVelocity>0&&(this.xVelocity=this.xVelocity*-1),this.flashMood>0&&(this.flashMood-=1),this.flashMood==0&&!this.isDead&&(this.mood="normal");for(t=0;t<i;t++)r=this.bolts[t],r.energy<=0?(this.bolts.splice(t,1),i-=1):(r.energy-=1,r.size+=2)},draw:function(n){var r=this.mid(),i=this.health*359/100*(Math.PI/180);n.save(),n.strokeStyle=this.health>50?t.lifelineGood:t.lifelineBad,n.lineWidth=2,n.beginPath(),n.arc(r.x,r.y,this.lifelineSize,0,i,!1),n.stroke(),n.closePath(),e.drawSprite(n,this.sprite,this.moods[this.mood],this.x,this.y),this.drawBolts(n),n.restore()},drawBolts:function(e){var n,r,i=this.bolts.length;for(n=0;n<i;n++)r=this.bolts[n],e.save(),e.beginPath(),e.strokeStyle=t.boltColor,e.arc(r.x,r.y,r.size,0,2*Math.PI,!1),e.stroke(),e.closePath()},mid:function(){return{x:this.x+this.size/2,y:this.y+this.size/2}},xy:function(){return{x:this.x,y:this.y}},position:function(){return{top:this.y,bottom:this.y+this.size,left:this.x,right:this.x+this.size}},gotThingy:function(e){this.score+=e.value,this.score<0&&(this.score=0),this.mood=e.value<0?"hurt":"happy",this.flashMood=u,e.role==="baddie"&&(this.health-=Math.abs(100*e.value/300),this.health=this.health<0?0:this.health),e.category==="health"?(this.health+=e.value,this.health=this.health>100?100:this.health):e.category==="ammo"&&(this.ammo+=e.value)}},l}),define("thingy",["util","colors"],function(e,t){function a(e){this.type=e.type,this.value=r[this.type].value,this.coords=r[this.type].coords,this.coordsOdd=r[this.type].coordsOdd,this.coordsEven=r[this.type].coordsEven,this.color=r[this.type].color,this.role=r[this.type].role,this.category=r[this.type].category,this.x=e.position.x,this.y=e.position.y,this.width=this.coords[2],this.height=this.coords[3],this.xVelocity=1,this.yVelocity=1,this.cH=e.canvas.height,this.cW=e.canvas.width,this.lifeTime=u,this.sprite=e.sprite,this.animFrames=0,this.isToddler=!0}var n=e.sprites,r={smiley:{role:"goody",coords:n.smiley,value:5,color:t.goody},laughy:{role:"goody",coords:n.laughy,value:50,color:t.goody},holy:{role:"goody",coords:n.holy,value:200,color:t.goody},geary:{role:"baddie",coords:n.geary[1],coordsOdd:n.geary[1],coordsEven:n.geary[2],value:-5,color:t.baddie},sunny:{role:"baddie",coords:n.sunny[1],coordsOdd:n.sunny[1],coordsEven:n.sunny[2],value:-50,color:t.baddie},rady:{role:"baddie",coords:n.rady[1],coordsOdd:n.rady[1],coordsEven:n.rady[2],value:-100,color:t.baddie},hearty:{role:"addon",category:"health",coords:n.bigHeart,value:20,color:t.goody},bolty:{role:"addon",category:"ammo",coords:n.bigBolt,value:1}},i=0,s=20,o=20,u=2e3;return a.prototype={_hitTheWall:function(){this.x<=0&&(this.xVelocity=Math.abs(this.xVelocity)),this.x+this.width>=this.cW-i&&(this.xVelocity=-Math.abs(this.xVelocity)),this.y<=i&&(this.yVelocity=Math.abs(this.yVelocity)),this.y+this.height>=this.cH-i&&(this.yVelocity=-Math.abs(this.yVelocity))},_randomMotion:function(t){t%100==0&&(e.randomNumber(10,50)>25?this.xVelocity=-this.xVelocity:this.yVelocity=-this.yVelocity)},_isCollided:function(t){var n=t.position(),r={x:this.x,y:this.y,h:this.height,w:this.width},i={x:n.left,y:n.top,h:t.size,w:t.size};e.collided(r,i)&&(t.gotThingy(this),this.isCollided=!0,this.lifeTime=s)},dropDead:function(){this.xVelocity=0,this.yVelocity=30,this.isZombie=!0},update:function(e,t){this.x+=this.xVelocity,this.y+=this.yVelocity,this.isZombie?this.y+this.height>=this.cH&&(this.lifeTime=0):(this._randomMotion(e),this._hitTheWall()),!this.isCollided&&!this.isDying&&!this.isToddler&&!this.isZombie&&this._isCollided(t),this.lifeTime-=1,!this.isDying&&this.lifeTime<=s&&(this.isDying=!0),this.isToddler&&u-this.lifeTime>=o&&(this.isToddler=!1),this.lifeTime<=0&&(this.isDead=!0,this.lifeTime=0),!this.isZombie&&this.role==="baddie"&&(this.animFrames>=10?(this.animFrames=0,this.coords=e%2===0?this.coordsEven:this.coordsOdd):this.animFrames++)},draw:function(t){var n,r,i,a;t.save();if(this.isCollided||this.isDying)t.globalAlpha=this.lifeTime/s;this.isToddler&&(t.globalAlpha=(u-this.lifeTime)/o),e.drawSprite(t,this.sprite,this.coords,this.x,this.y,a),!this.isDying&&!this.isCollided&&(t.fillStyle=this.color,t.font="7pt Courier",i=this.value<0?"":"+",n=this.x+this.width/2-10,r=this.y+(this.height+10),t.fillText(i+this.value,n,r)),t.restore()}},a}),define("hud",["util","colors"],function(e,t){function h(e){this.init(e.canvas),i=e.sprite}var n,r,i,s,o,u=30,a,f,l,c;return h.prototype={init:function(t){n=t.width,r=t.height,this.score=0,this.health=100,this.ammo=0,s=e.sprites.heart,o=e.sprites.bolt,a=n/2-s[2]/2-14,f=u/2-s[3]/2,l=n-50,c=u/2-o[3]/2},update:function(e){this.score=e.score,this.health=e.health,this.ammo=e.ammo},draw:function(r){r.save(),r.beginPath(),r.fillStyle=t.hudColor,r.fillRect(0,0,n,u),e.drawSprite(r,i,s,a,f),e.drawSprite(r,i,o,l,c),r.font="10pt Audiowide",r.fillStyle=t.hudText,r.textAlign="left",r.fillText(Math.floor(this.health),a+27,f+13),r.fillText(this.ammo,l+20,f+13),r.fillText(this.score,20,f+13),r.closePath(),r.restore()}},h}),define("game",["util","colors","suzhi","thingy","hud"],function(e,t,n,r,s){var o,u,a,f,l=0,c,h,p=[],d=20,v=10,m=0,g=0,y,b={intro:1,game:2,over:3},w=b.intro,E,S,x;return{init:function(t){y=t.env,E=t.sprite,this.setupCanvas(),this.setupHandlers(),this.initObjects(),this.run(),x={x:g/2-e.sprites.okayBtn[2]/2,y:m/2+50,w:e.sprites.okayBtn[2],h:e.sprites.okayBtn[3]},S=this},initObjects:function(){c=new n({env:y,canvas:o,sprite:E}),h=new s({canvas:o,sprite:E}),p=[]},start:function(){this.initObjects(),w=b.game,l=0},run:function(){var e=this,t=function(){e.update(),e.render(),window.requestAnimFrame(t)};window.requestAnimFrame(t)},update:function(){var e,t,n;l+=1,w===b.intro,w===b.game&&(c.isDead?w=b.over:this.updateGameWorld()),w===b.over},makeThingy:function(t){return new r({type:t,position:e.randomPoint(o,20),canvas:o,sprite:E})},updateGameWorld:function(){l%300==0&&(p.push(this.makeThingy(e.randomGoody())),p.push(this.makeThingy(e.randomBaddie()))),l%500==0&&p.push(this.makeThingy(e.randomAddon())),c.update(),h.update({score:c.score,health:c.health,ammo:c.ammo});for(i=0,gCount=p.length;i<gCount;i++)thingy=p[i],thingy.isDead?(p.splice(i,1),gCount--):(!thingy.isZombie&&c.isBolted(thingy)&&thingy.dropDead(),p[i].update(l,c))},render:function(){this.clearCanvas(),u.fillStyle=t.bg,u.fillRect(0,0,a,f),w===b.intro&&this.drawIntro(u),w===b.game&&this.renderGameWorld(u),w===b.over&&(this.renderGameWorld(u),this.drawGameOver(u)),this.drawFireBed(u)},drawIntro:function(t){var n=50,r=0,i=20,s=e.sprites.suzhiTitle;e.drawSprite(t,E,s,g/2-s[2]/2,n),n+=s[3]+4*i,this.drawHelp(t,n)},drawHelp:function(t,n){var n=n||50,r=0,i=20,s=e.sprites.lblControls,o=e.sprites.arrowKeys,u=e.sprites.spacebar,a=e.sprites.lblMove,f=e.sprites.lblFire,l=e.sprites.lblPress,c=e.sprites.lblEnterKey,h=e.sprites.lblToStart;r+=g/2-o[2]-50,e.drawSprite(t,E,o,r,n),r+=o[2]+i,n+=o[3]-u[3],e.drawSprite(t,E,u,r,n),n+=u[3]+i/2,e.drawSprite(t,E,a,160,n),e.drawSprite(t,E,f,340,n),r=g/2-l[2]/2,n+=f[3]+3*i,e.drawSprite(t,E,l,r,n),r=g/2-c[2]/2,n+=l[3]+i,e.drawSprite(t,E,c,r,n)},drawGameOver:function(n){var r=e.sprites.gameOver,i=e.sprites.okayBtn,s=e.sprites.score;e.drawSprite(n,E,r,g/2-r[2]/2,100),e.drawSprite(n,E,s,g/2-s[2]/2,150),n.font="30pt Audiowide",n.fillStyle=t.suzhi,n.textAlign="center",n.fillText(c.score,g/2,230),this.drawHelp(n,280)},renderGameWorld:function(e){var t,n=p.length;c.draw(e);for(t=0;t<n;t++)p[t].draw(e);h.draw(e)},drawFireBed:function(t){var n="",r=35,i=18,s=0,o=m-r,u=l;while(s<=g)n=e.sprites.fire[u%16],u++,e.drawSprite(t,E,n,s,o),s+=2*i},clearCanvas:function(){u.save(),u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,o.width,o.height),u.beginPath(),u.restore()},setupCanvas:function(){var e=y.canTouch?"touchstart":"mousedown";o=document.createElement("canvas"),u=o.getContext&&o.getContext("2d"),a=y.viewport.width,f=y.viewport.height,a>=500&&(a=600,f=600),o.width=a,o.height=f,document.getElementById("game").appendChild(o),m=o.height,g=o.width},setupHandlers:function(){window.addEventListener("keydown",function(t){e.isAGameKey(t.keyCode)&&(t.stopImmediatePropagation(),t.preventDefault(),S.handleKey(t.keyCode))})},handleKey:function(t){w===b.intro?S.start():w===b.game?c.actOn(t):w===b.over&&t===e.keys.ENTER&&S.start()},handleClickStart:function(t){if(w===b.intro)S.initObjects(),w=b.game;else if(w===b.game)c.jump(e.getMouseAt(t,o));else if(w===b.over){var n=e.getMouseAt(t,o),r={x1:x.x,x2:x.x+x.w,y1:x.y,y2:x.y+x.h};e.isPointInsideBox(r,n)&&(S.initObjects(),w=b.game)}}}}),require(["game","util"],function(e,t){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var n=new Image;n.onload=function(){e.init({env:t.env(),sprite:this})},n.src="assets/img/sprite102.png"}),define("main",function(){});